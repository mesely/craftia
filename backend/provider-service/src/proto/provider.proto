syntax = "proto3";

package provider;

service ProviderService {
  rpc Create (CreateProviderRequest) returns (ProviderResponse);
  rpc FindAll (FindAllRequest) returns (ProviderListResponse);
  rpc FindNearby (NearbyRequest) returns (ProviderListResponse);
  rpc FindOne (IdRequest) returns (ProviderResponse);
  rpc Update (UpdateProviderRequest) returns (ProviderResponse); 
  rpc Delete (IdRequest) returns (DeleteResponse);

  rpc GetCities (Empty) returns (CityList);
  rpc GetDistricts (CityRequest) returns (DistrictList);
  rpc GetCategories (Empty) returns (CategoryList);

  rpc StartGoogleCrawl (Empty) returns (CrawlStats);
  rpc StartTurkeyGeneralCrawl (Empty) returns (CrawlStats);
}

message Empty {}
message IdRequest { string id = 1; }
message CityRequest { string city = 1; }

message NearbyRequest {
  double lat = 1;
  double lng = 2;
  double radius = 3;
}

message FindAllRequest {
  int32 page = 1;
  int32 limit = 2;
  string mainType = 3;
  string subType = 4;
  string city = 5;
  string sort = 6;
  double userLat = 7;
  double userLng = 8;
  string sortMode = 9;
}

message CreateProviderRequest {
  string name = 1;
  string phone = 2;
  string businessName = 3;
  string phoneNumber = 4;
  string category = 5;
  string city = 6;
  string district = 7;
  string address = 8;
  double lat = 9;
  double lng = 10;
  string profileImage = 11;
  repeated string portfolioImages = 12;
  map<string, string> priceList = 13;
  string subType = 14;
  bool isPremium = 15;
}

message UpdateProviderRequest {
  string id = 1;
  string businessName = 2;
  string phoneNumber = 3;
  string category = 4;
  string city = 5;
  string district = 6;
  string address = 7;
  double lat = 8;
  double lng = 9;
  string profileImage = 10;
  repeated string portfolioImages = 11;
  map<string, string> priceList = 12;
  // ✅ EKLENDİ: Bu 3 alan eksikti, isPremium gateway'den geçemiyordu
  string mainType = 13;
  string subType = 14;
  bool isPremium = 15;
}

message ProviderResponse {
  string _id = 1; 
  string businessName = 2;
  string phoneNumber = 3;
  string city = 4;
  string district = 5;
  string address = 6;
  double lat = 7;
  double lng = 8;
  string mainType = 9;
  string subType = 10;
  double rating = 11;
  bool isPremium = 12;
  double distance = 13;
  string profileImage = 14;
  repeated string portfolioImages = 15;
  map<string, string> priceList = 16;
}

message ProviderListResponse { 
  repeated ProviderResponse providers = 1; 
  int32 total = 2;
  int32 page = 3;
  int32 lastPage = 4;
}

message DeleteResponse { bool success = 1; }
message CityList { repeated Item items = 1; }
message DistrictList { repeated Item items = 1; }
message CategoryList { repeated Item items = 1; }
message Item { string id = 1; string name = 2; }
message CrawlStats { int32 totalFound = 1; int32 newlySaved = 2; int32 skipped = 3; }
